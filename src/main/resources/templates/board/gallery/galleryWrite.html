<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<div layout:fragment="content">

    <div class="container">

        <header id="article-form-header" class="py-5 text-center">
            <h2>게시글 작성</h2>
        </header>

        <form id="uploadForm" action="/gallery/write" method="post" enctype="multipart/form-data">
            <input type="hidden" name="urlCategory" th:value="gallery">
            <input type="hidden" name="categoryBoard" value="GALLERY">

            <div class="row mb-3 justify-content-md-center">
                <label for="boardTitle" class="col-sm-2 col-lg-1 col-form-label text-sm-end">Title : </label>
                <div class="col-sm-8 col-lg-9">
                    <input type="text" class="form-control" id="boardTitle" name="boardTitle" required>
                </div>
            </div>

            <div class="row mb-3 justify-content-md-center">
                <label for="boardContent" class="col-sm-2 col-lg-1 col-form-label text-sm-end">Content : </label>
                <div class="col-sm-8 col-lg-9">
                    <textarea class="form-control" id="boardContent" name="boardContent" rows="10" required></textarea>
                </div>
            </div>

            <div class="row mb-3 justify-content-md-center">
                <label for="attachedFiles" class="col-sm-2 col-lg-1 col-form-label text-sm-end">File : </label>
                <div class="col-sm-8 col-lg-9">
                    <input class="form-control" id="file" name="file" type="file">
                </div>
            </div>

            <div class="row mb-5 justify-content-md-center">
                <div class="col-sm-10 d-grid gap-2 d-sm-flex justify-content-sm-end">
                    <button type="submit" class="btn btn-primary" id="btn-file-save">등록</button>
                    <a href="/gallery" role="button" class="btn btn-secondary">취소</a>
                </div>
            </div>
        </form>
    </div>

</div>

<script>
    $(document).ready(function () {
        $('#uploadForm').submit(function(event) {
            event.preventDefault();

            let formData = new FormData(this);
            let file = $('#file')[0].files;

            if (file.length === 0) {
                alert('파일을 선택해주세요.');
                return false;
            }

            $.ajax({
                type: 'POST',
                url: '/gallery/write',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    // 업로드 성공 시 처리
                    alert('파일 업로드가 완료되었습니다.');
                    // 추가로 필요한 로직 구현
                },
                error: function(error) {
                    // 에러 발생 시 처리
                    alert('파일 업로드에 실패하였습니다.');
                }
            });
        })
    })
</script>
